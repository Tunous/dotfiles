#! /bin/sh

# Init {{{

if [ $(pgrep -cx panel) -gt 1 ] ; then
  printf "%s\n" "The panel is already running." >&2
  exit 1
fi

trap 'trap - TERM; kill 0' INT TERM QUIT EXIT

flavor=${1:-dzen2}

# }}}
# Fifo {{{

[ -e "$PANEL_FIFO" ] && rm "$PANEL_FIFO"
mkfifo "$PANEL_FIFO"

bspc control --subscribe > "$PANEL_FIFO" &

# }}}
# Variables {{{

PANEL_HEIGHT=15
FONT_FAMILY='-*-terminus-medium-r-normal-*-12-*-*-*-c-*-*-1'
DZEN="dzen2 -h $PANEL_HEIGHT -dock -ta l -title-name panel -fn $FONT_FAMILY -e 'button3=;'"

# }}}

bspc config top_padding $PANEL_HEIGHT

# Run selected panel
case "$flavor" in
  bar) cat "$PANEL_FIFO" | panel_bar | bar & ;;
  dzen2) cat "$PANEL_FIFO" | panel_dzen2 | $DZEN & ;;
esac

wait
