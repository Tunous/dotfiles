#!/bin/bash

[[ "$1" == "-h" ]] && echo "Usage: $(basename $0) [+|-|!]" && exit 0

level() {
    amixer get Master | sed -n 's/^.*\[\([0-9]\+%\).*/\1/p' | uniq
}

state() {
    amixer get Master | sed -n 's/^.*\[\(o[nf]\+\)]$/\1/p' | uniq
}

bar() {
    vol="$(level | cut -d% -f1)"
    color="%{F#ff606060}"
    icon=""
    if [[ "$(state)" == "off" ]] || (( vol == 0 )); then
        icon=""
        color="%{F#ffaf0000}"
    elif (( vol < 25 )); then
        icon=""
    elif (( vol < 70 )); then
        icon=""
    fi

    printf "$icon %s " "$vol%%"

    for i in {0..10}; do
        percent="$(( i * 10 ))"
        if (( vol >= percent && vol != 0 )); then
            printf "%s" "$color—%{F-}"
        else
            printf "%s" "%{F#ff303030}—%{F-}"
        fi
    done
}

[[ $# == 0 ]] && echo "$(level) $(state)" && exit 0

case $1 in
    +) amixer set Master 1%+ >/dev/null ;;
    -) amixer set Master 1%- >/dev/null ;;
    !) amixer set Master toggle >/dev/null ;;
    state|level|bar) $1 ;;
    *) amixer set Master $1 >/dev/null
esac
