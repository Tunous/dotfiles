#!/bin/bash

choice=$(find $PASSWORD_STORE_DIR -name *gpg -print | sed "s,$PASSWORD_STORE_DIR/,,;s,.gpg$,," | sort | dmenu-get "Select password")

if [[ -z "$choice" ]]; then
    echo "Nothing selected"
    exit
fi

info=$(pass $choice)
password=$(echo "$info" | head -n 1)
username=$(echo "$info" | grep '^username: ' | cut -c 11-)

if [[ -n "$password" ]]; then
    if [[ -n "$username" ]]; then
        xdotool type $username
        xdotool key "Tab"
    fi

    xdotool type $password
    [[ -n "$username" ]] && xdotool key "Return"
fi
